<!DOCTYPE html>
<html lang="zh_CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>投资组合联合线模拟——两资产、三资产 | Zhang Jian&#39;s Homepage</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">首页</a></li>
      
      <li><a href="/cv/">CV</a></li>
      
      <li><a href="/categories/">分类</a></li>
      
      <li><a href="/tags/">Tags</a></li>
      
      <li><a href="/index.xml">订阅</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">投资组合联合线模拟——两资产、三资产</span></h1>
<h2 class="author">张剑</h2>
<h2 class="date">2020/04/09</h2>

<p class="terms">
    
    
    Categories:
    
    <a href='/categories/%E6%8A%95%E8%B5%84%E5%AD%A6'>投资学</a>
    
    
    
    
    Tags:
    
    <a href='/tags/r'>R</a>
    
    
    
  </p>

</div>

<main>

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>
<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/datatables-binding/datatables.js"></script>
<link href="/rmarkdown-libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="/rmarkdown-libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="/rmarkdown-libs/dt-core/js/jquery.dataTables.min.js"></script>
<link href="/rmarkdown-libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/crosstalk/js/crosstalk.min.js"></script>

<div id="TOC">
<ul>
<li><a href="#两个资产的联合线的拟合">两个资产的联合线的拟合</a></li>
<li><a href="#三个资产有效投资域的拟合">三个资产有效投资域的拟合</a>
<ul>
<li><a href="#三个资产的思路">三个资产的思路</a></li>
</ul></li>
</ul>
</div>

<div id="两个资产的联合线的拟合" class="section level2">
<h2>两个资产的联合线的拟合</h2>
<div id="参考我们ppt上案例使用软件对两个不同的相关性程度进联合线模拟" class="section level4">
<h4>参考我们ppt上案例，使用软件对两个不同的相关性程度进联合线模拟</h4>
<blockquote>
<p>使用tidyver包绘图，DT包展示数据</p>
</blockquote>
<hr />
</div>
<div id="参考ppt给出我们想画的两个资产默认的均值标准差同时两资产默认相关系数为0" class="section level4">
<h4>参考ppt给出我们想画的两个资产默认的均值、标准差，同时两资产默认相关系数为0</h4>
</div>
<div id="可以自行调整函数参数" class="section level4">
<h4>可以自行调整函数参数</h4>
</div>
<div id="函数编好大家也可以自行测试" class="section level4">
<h4>函数编好，大家也可以自行测试</h4>
<pre class="r"><code>pacman::p_load(tidyverse,DT)
sqx &lt;- function(w,r_a=0.1,r_b=0.04,sd_a=0.05,sd_b=0.1,rho=0){
  risk = sqrt(w^2*sd_a^2+(1-w)^2*sd_b^2+2*w*(1-w)*rho*sd_a*sd_b)
  mean = w*r_a+(1-w)*r_b
  res = tibble(mean=mean,risk=risk) 
  return(res)}

sqx(1.5)</code></pre>
<pre><code>## # A tibble: 1 x 2
##    mean   risk
##   &lt;dbl&gt;  &lt;dbl&gt;
## 1  0.13 0.0901</code></pre>
<pre class="r"><code>res_1 &lt;- NULL
for (i in seq(-0.5,1.5,by=0.1)){
  res_1 = rbind(res_1,sqx(i))
  }

res_1 %&gt;% datatable()</code></pre>
<div id="htmlwidget-1" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21"],[0.01,0.016,0.022,0.028,0.034,0.04,0.046,0.052,0.058,0.064,0.07,0.076,0.082,0.088,0.094,0.1,0.106,0.112,0.118,0.124,0.13],[0.152069063257456,0.14142135623731,0.130862523283024,0.120415945787923,0.110113577727726,0.1,0.0901387818865997,0.0806225774829855,0.0715891053163818,0.0632455532033676,0.0559016994374947,0.05,0.0460977222864644,0.0447213595499958,0.0460977222864645,0.05,0.0559016994374948,0.0632455532033676,0.0715891053163818,0.0806225774829855,0.0901387818865997]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>mean<\/th>\n      <th>risk<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>ggplot(res_1,aes(x=mean,y=risk)) + geom_point() + tidyquant::theme_tq()+
  geom_line() + xlab(&#39;收益率&#39;) + ylab(&#39;风险&#39;) + ggtitle(&#39;两种资产随着权重不同带来的收益率和风险的组合&#39;,subtitle = &#39;这里相关系数rho为0，两个完全不相关的资产&#39;) +coord_flip() +
  geom_hline(yintercept = 0,color= &#39;red&#39;,alpha =0.4)</code></pre>
<p><img src="/post/2020-04-08-投资组合联合线模拟_files/figure-html/unnamed-chunk-1-2.png" width="672" /></p>
<pre class="r"><code>res_2 &lt;- NULL
for (i in seq(-0.5,3,by=0.1)){
  res_2 = rbind(res_2,sqx(i, rho = -1))
}

res_2 %&gt;% datatable()</code></pre>
<div id="htmlwidget-2" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"],[0.01,0.016,0.022,0.028,0.034,0.04,0.046,0.052,0.058,0.064,0.07,0.076,0.082,0.088,0.094,0.1,0.106,0.112,0.118,0.124,0.13,0.136,0.142,0.148,0.154,0.16,0.166,0.172,0.178,0.184,0.19,0.196,0.202,0.208,0.214,0.22],[0.175,0.16,0.145,0.13,0.115,0.1,0.085,0.07,0.055,0.04,0.025,0.00999999999999997,0.00500000000000007,0.02,0.035,0.05,0.065,0.08,0.095,0.11,0.125,0.14,0.155,0.17,0.185,0.2,0.215,0.23,0.245,0.26,0.275,0.29,0.305,0.32,0.335,0.35]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>mean<\/th>\n      <th>risk<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>ggplot(res_2,aes(x=mean,y=risk)) + geom_point() + tidyquant::theme_tq()+
  geom_line() + xlab(&#39;收益率&#39;) + ylab(&#39;风险&#39;) + ggtitle(&#39;两种资产随着权重不同带来的收益率和风险的组合&#39;,subtitle = &#39;这里相关系数rho为-1，两个完全富相关的资产&#39;) +coord_flip()+
  geom_hline(yintercept = 0,color= &#39;red&#39;,alpha =0.4)</code></pre>
<p><img src="/post/2020-04-08-投资组合联合线模拟_files/figure-html/unnamed-chunk-1-4.png" width="672" /></p>
<pre class="r"><code>res_3 &lt;- NULL

for (i in seq(-0.5,3,by=0.1)){
  res_3 = rbind(res_3,sqx(i, rho = 1))
}

res_3 %&gt;% datatable()</code></pre>
<div id="htmlwidget-3" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-3">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"],[0.01,0.016,0.022,0.028,0.034,0.04,0.046,0.052,0.058,0.064,0.07,0.076,0.082,0.088,0.094,0.1,0.106,0.112,0.118,0.124,0.13,0.136,0.142,0.148,0.154,0.16,0.166,0.172,0.178,0.184,0.19,0.196,0.202,0.208,0.214,0.22],[0.125,0.12,0.115,0.11,0.105,0.1,0.095,0.09,0.085,0.08,0.075,0.07,0.065,0.06,0.055,0.05,0.045,0.04,0.035,0.03,0.025,0.02,0.015,0.0100000000000001,0.00500000000000007,0,0.00499999999999972,0.0100000000000001,0.0150000000000001,0.0200000000000001,0.025,0.0300000000000002,0.0350000000000001,0.0400000000000001,0.0450000000000001,0.05]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>mean<\/th>\n      <th>risk<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>ggplot(res_3,aes(x=mean,y=risk)) + geom_point() + tidyquant::theme_tq()+
  geom_line() + xlab(&#39;收益率&#39;) + ylab(&#39;风险&#39;) + ggtitle(&#39;两种资产随着权重不同带来的收益率和风险的组合&#39;,subtitle = &#39;这里相关系数rho为+1，两个完全正相关的资产&#39;) +coord_flip()+
  geom_hline(yintercept = 0,color= &#39;red&#39;,alpha =0.4)</code></pre>
<p><img src="/post/2020-04-08-投资组合联合线模拟_files/figure-html/unnamed-chunk-1-6.png" width="672" /></p>
</div>
</div>
<div id="三个资产有效投资域的拟合" class="section level2">
<h2>三个资产有效投资域的拟合</h2>
<div id="三个资产的思路" class="section level3">
<h3>三个资产的思路</h3>
<blockquote>
<ol style="list-style-type: decimal">
<li>需要有权重矩阵，收益矩阵，方差协方差矩阵</li>
</ol>
</blockquote>
<blockquote>
<ol start="2" style="list-style-type: decimal">
<li>给定收益矩阵、方差协方差矩阵，改变收益矩阵就可以生成许多投资组合的期望收益和方差</li>
</ol>
</blockquote>
<blockquote>
<ol start="3" style="list-style-type: decimal">
<li>先给定各个资产的期望收益矩阵、方差协方差矩阵</li>
</ol>
</blockquote>
<div id="先给定相关参数" class="section level4">
<h4>先给定相关参数</h4>
<pre class="r"><code>ret_m &lt;- matrix(c(0.15,0.12,0.3),nrow=3) 
sigma &lt;- matrix(c(0.1,0.02,-0.06,
                     0.02,0.012,0.07,
                     -0.06,0.07,0.4),nrow=3) # 3*3</code></pre>
</div>
<div id="我们的目标是随机生成一系列w矩阵生成一堆点" class="section level4">
<h4>我们的目标是随机生成一系列w矩阵生成一堆点</h4>
</div>
<div id="同时我们有一个约束条件就是要求权重之和等于1" class="section level4">
<h4>同时我们有一个约束条件，就是要求权重之和等于1</h4>
<pre class="r"><code>pacman::p_load(gtools,tidyverse)
perms &lt;- permutations(n=50,r=3,seq(-15,15,by = 0.5),repeats.allowed = T)
perms1 &lt;- perms[rowSums(perms) == 10,]
perms1 &lt;- perms1/10
set.seed(123)
my_perms &lt;- perms1[sample(nrow(perms1), 10000, replace=T),]
str(my_perms)</code></pre>
<pre><code>##  num [1:10000, 1:3] 0.5 0.55 0 0.65 0.05 -0.2 0.25 0.1 0.15 -0.7 ...</code></pre>
<pre class="r"><code>w &lt;- as_tibble(my_perms)</code></pre>
<pre><code>## Warning: The `x` argument of `as_tibble.matrix()` must have column names if `.name_repair` is omitted as of tibble 2.0.0.
## Using compatibility `.name_repair`.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<pre class="r"><code>colnames(w) &lt;- c(&#39;w1&#39;,&#39;w2&#39;,&#39;w3&#39;)
# 生成了1000个满足要求的矩阵
p_ret &lt;- c()
p_sig &lt;- c()
for (i in seq(1,10000)){
  p_ret = append(p_ret,as.matrix(w[i,]) %*% ret_m)
  p_sig = append(p_sig,sqrt(as.matrix(w[i,]) %*% sigma %*% t(as.matrix(w[i,]))))
}
df &lt;- tibble(p_ret,p_sig)
df &lt;- df %&gt;% drop_na()</code></pre>
</div>
<div id="我需要的数据组合的均值和标准差都有了可以作图了确实有缺口尾部现象" class="section level4">
<h4>我需要的数据——组合的均值和标准差都有了，可以作图了，确实有缺口尾部现象</h4>
<pre class="r"><code>ggplot(df,aes(p_sig, p_ret)) + geom_point() + tidyquant::theme_tq() +
  xlab(&#39;组合的风险&#39;) + ylab(&#39;组合的收益&#39;) + ggtitle(&#39;三个资产的投资有效边界模拟&#39;) </code></pre>
<p><img src="/post/2020-04-08-投资组合联合线模拟_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
</div>
</div>

</main>

  <footer>
  <script src="//yihui.name/js/math-code.js"></script>
<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<script async src="//yihui.name/js/center-img.js"></script>

  
  <hr/>
  © <a href="https://jjxy.sicau.edu.cn/content.jsp?urltype=news.NewsContentUrl&amp;wbtreeid=1022&amp;wbnewsid=3019">张剑</a>  2018 &ndash; 2020 | <a href="https://gitee.com/jefeerzhang">Gitee</a>
  
  </footer>
  </body>
</html>

