<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bond Valuation | Zhang Jian&#39;s Homepage</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">首页</a></li>
      
      <li><a href="/cv/">CV</a></li>
      
      <li><a href="/categories/">分类</a></li>
      
      <li><a href="/tags/">Tags</a></li>
      
      <li><a href="/index.xml">订阅</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">Bond Valuation</span></h1>
<h2 class="author">张剑</h2>
<h2 class="date">2020/03/21</h2>
</div>

<main>



<div id="债券估值基础" class="section level2">
<h2>债券估值基础</h2>
<div id="假设债券的现金流如下投资面值为100元票面利率为5到期日为5年的债券" class="section level3">
<h3>假设债券的现金流如下：投资面值为100元，票面利率为5％，到期日为5年的债券。</h3>
</div>
<div id="息票利率是您从持有债券中获得的利息因此在债券到期之前每年将获得5美元的息票付款到期时您还将获得100的面值返还" class="section level3">
<h3>息票利率是您从持有债券中获得的利息，因此，在债券到期之前，每年将获得5美元的息票付款。到期时，您还将获得100的面值返还。</h3>
<p>计算每个现金流量的现值</p>
<p>计算债券的价值</p>
<p>假设我们给定该债券的到期收益率为6%</p>
<pre class="r"><code># 先调入包
library(tidyverse)
library(ggthemes) # ggplot2的主题包
library(ggfortify)

cf &lt;- c(5,5,5,5,105)
cf_df &lt;- as_tibble(cf)</code></pre>
<pre><code>## Warning: Calling `as_tibble()` on a vector is discouraged, because the behavior is likely to change in the future. Use `tibble::enframe(name = NULL)` instead.
## This warning is displayed once per session.</code></pre>
<pre class="r"><code># 生成一个时间序列
cf_df &lt;- cf_df %&gt;%
  mutate(year = as.numeric(rownames(cf_df))) %&gt;%
  rename(cf = value)
cf_df</code></pre>
<pre><code>## # A tibble: 5 x 2
##      cf  year
##   &lt;dbl&gt; &lt;dbl&gt;
## 1     5     1
## 2     5     2
## 3     5     3
## 4     5     4
## 5   105     5</code></pre>
<pre class="r"><code># 继续生成一个每一期的现金流的现值
cf_df &lt;- cf_df %&gt;%
  mutate(pv = cf/(1+0.06)^year)
cf_df</code></pre>
<pre><code>## # A tibble: 5 x 3
##      cf  year    pv
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     5     1  4.72
## 2     5     2  4.45
## 3     5     3  4.20
## 4     5     4  3.96
## 5   105     5 78.5</code></pre>
<pre class="r"><code>sum(cf_df$pv)</code></pre>
<pre><code>## [1] 95.78764</code></pre>
</div>
<div id="以上是我们分步计算得到的结果接下来我们尝试把上面的内容写成一个函数" class="section level3">
<h3>以上是我们分步计算得到的结果，接下来我们尝试把上面的内容写成一个函数</h3>
<div id="一个函数需要给定一些参数" class="section level4">
<h4>一个函数需要给定一些参数：</h4>
<ul>
<li>p —— 面值</li>
<li>r —— coupon rate（票息率）</li>
<li>t —— 到期时间 time to maturity</li>
<li>y —— 该债券的到期收益率</li>
</ul>
</div>
</div>
</div>
<div id="最基本的债券定价" class="section level2">
<h2>最基本的债券定价</h2>
<pre class="r"><code>bond_val &lt;- function(p=100,r,t,y) {
  cf &lt;- c(rep(p*r,t-1),p*(1+r))
  cf_df &lt;- as_tibble(cf)
  cf_df &lt;- cf_df %&gt;%
  mutate(year = as.numeric(rownames(cf_df))) %&gt;%
  rename(cf = value)
  cf_df &lt;- cf_df %&gt;%
  mutate(pv = cf/(1+y)^year)
  return(sum(cf_df$pv))
}
bond_val(r=0.01,t=10,y=0.03)</code></pre>
<pre><code>## [1] 82.93959</code></pre>
</div>
<div id="模拟" class="section level2">
<h2>模拟</h2>
<div id="展示保持其他因素不变只改变rty中一个债券价格变化" class="section level3">
<h3>展示保持其他因素不变，只改变r,t,y中一个，债券价格变化</h3>
<pre class="r"><code># 首先保持其他不变只改变息票率，其他的类似
sim_bond &lt;- NULL
for (i in seq(0,1,by=0.05)){
  sim_bond &lt;- c(sim_bond,bond_val(r=i,t=10,y=0.03))
}
df &lt;- tibble(bond_v = sim_bond,r=seq(0,1,by=0.05))
ggplot(df,mapping = aes(x=r,y=bond_v))+  geom_point()+
         geom_line() + theme_clean()+ggtitle(&#39;只改变息票率r其他因素保持不变&#39;)+
  xlab(&quot;债券的息票率&quot;) + ylab(&#39;债券价格&#39;)</code></pre>
<p><img src="/post/bond-valuation_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<pre class="r"><code>#依葫芦画瓢
sim_bond &lt;- NULL
for (i in seq(0,1,by=0.05)){
  sim_bond &lt;- c(sim_bond,bond_val(r=0.05,t=10,y=i))
}
df &lt;- tibble(bond_v = sim_bond,y=seq(0,1,by=0.05))
ggplot(df,mapping = aes(x=y,y=bond_v))+ geom_point()+
         geom_line() + theme_clean()+ggtitle(&#39;只改变到期收益率y其他因素保持不变&#39;)+
  xlab(&quot;债券的到期收益率&quot;) + ylab(&#39;债券价格&#39;)</code></pre>
<p><img src="/post/bond-valuation_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<pre class="r"><code>#依葫芦画瓢2
sim_bond &lt;- NULL
for (i in seq(1,30,by=1)){
  sim_bond &lt;- c(sim_bond,bond_val(r=0.05,t=i,y=0.03))
}
df &lt;- tibble(bond_v = sim_bond,t=seq(1,30,by=1))
ggplot(df,mapping = aes(x=t,y=bond_v))+ geom_point()+
         geom_line() + theme_clean()+ggtitle(&#39;只改变到期时间t其他因素保持不变&#39;)+
  xlab(&quot;债券的到期时间&quot;) + ylab(&#39;债券到期时间&#39;)</code></pre>
<p><img src="/post/bond-valuation_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
</div>
<div id="什么决定了债券的yield" class="section level2">
<h2>什么决定了债券的yield？</h2>
<ul>
<li>真实利率 The real rate of interest</li>
<li>预期通胀率 Expected future inflation</li>
<li>利率风险 Interest rate risk</li>
<li>违约风险溢价 Default risk premium</li>
<li>流动性溢价 Liquidity premium</li>
</ul>
<hr />
</div>
<div id="各种因素对债券价格的影响" class="section level2">
<h2>各种因素对债券价格的影响</h2>
<div id="到期收益率变化对债券价格的影响" class="section level3">
<h3>到期收益率变化对债券价格的影响</h3>
</div>
<div id="微小的变化上升或下降对债券价格的影响是对称的" class="section level3">
<h3>微小的变化（上升、或下降）对债券价格的影响是对称的</h3>
</div>
<div id="如果比较大的yield变化对债券价格的影响是非对称的" class="section level3">
<h3>如果比较大的yield变化对债券价格的影响是非对称的</h3>
<pre class="r"><code># 继续利用我们上面写的函数进行演示
c_1 &lt;- bond_val(r=0.1,t=20,y=0.101)/bond_val(r=0.1,t=10,y=0.1)-1
c_2 &lt;- bond_val(r=0.1,t=20,y=0.099)/bond_val(r=0.1,t=10,y=0.1)-1
paste(&quot;到期收益率上涨时价格变化%&quot;,c_1)</code></pre>
<pre><code>## [1] &quot;到期收益率上涨时价格变化% -0.00845577581019019&quot;</code></pre>
<pre class="r"><code>paste(&quot;到期收益率下降时价格变化%&quot;,c_2)</code></pre>
<pre><code>## [1] &quot;到期收益率下降时价格变化% 0.00857199787894491&quot;</code></pre>
<pre class="r"><code>#当到期收益率变化较大时
c_3 &lt;- bond_val(r=0.1,t=20,y=0.14)/bond_val(r=0.1,t=10,y=0.1)-1
c_4 &lt;- bond_val(r=0.1,t=20,y=0.06)/bond_val(r=0.1,t=10,y=0.1)-1
paste(&quot;到期收益率上涨时价格变化%&quot;,c_3)</code></pre>
<pre><code>## [1] &quot;到期收益率上涨时价格变化% -0.264925222064638&quot;</code></pre>
<pre class="r"><code>paste(&quot;到期收益率下降时价格变化%&quot;,c_4)</code></pre>
<pre><code>## [1] &quot;到期收益率下降时价格变化% 0.45879684874261&quot;</code></pre>
</div>
<div id="票息率越低债券变异性更大敏感性越强受到到期收益率的影响越大" class="section level3">
<h3>票息率越低，债券变异性更大（敏感性越强），受到到期收益率的影响越大</h3>
<pre class="r"><code>c_5 &lt;- bond_val(r=0.1,t=20,y=0.08)/bond_val(r=0.1,t=20,y=0.1)-1
c_6 &lt;- bond_val(r=0.05,t=20,y=0.08)/bond_val(r=0.05,t=20,y=0.1)-1
c_7 &lt;- bond_val(r=0,t=20,y=0.08)/bond_val(r=0,t=20,y=0.1)-1
paste(&quot;大票息债券的变化%&quot;,c_5)</code></pre>
<pre><code>## [1] &quot;大票息债券的变化% 0.196362948148986&quot;</code></pre>
<pre class="r"><code>paste(&quot;小票息债券的变化%&quot;,c_6)</code></pre>
<pre><code>## [1] &quot;小票息债券的变化% 0.228328021964517&quot;</code></pre>
<pre class="r"><code>paste(&quot;零息债券的变化%&quot;,c_7)</code></pre>
<pre><code>## [1] &quot;零息债券的变化% 0.44337305443869&quot;</code></pre>
<pre class="r"><code>#依葫芦画瓢
sim_bond &lt;- NULL
for (i in seq(0,1,by=0.05)){
  sim_bond &lt;- c(sim_bond,bond_val(r=0.05,t=10,y=i))
}
sim_bond_2 &lt;- NULL
for (i in seq(0,1,by=0.05)){
  sim_bond_2 &lt;- c(sim_bond_2,bond_val(r=0.2,t=10,y=i))
}


df &lt;- tibble(littlec = sim_bond,morec=sim_bond_2, y=seq(0,1,by=0.05)) %&gt;%
  gather(key = &#39;key&#39;,value=&#39;value&#39;,-y)

ggplot(df,aes(x=y,y=value,color=key),size=1.1,alpha=0.7) +
  geom_line(size=1.1,alpha=0.7)+ggtitle(&#39;大票息vs小票息&#39;)+
  xlab(&quot;债券的到期收益率&quot;) + ylab(&#39;债券价格&#39;)+theme_clean()</code></pre>
<p><img src="/post/bond-valuation_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
</div>
<div id="更长的到期时间债券变异性更大敏感性越强收到到期收益率的影响越大" class="section level3">
<h3>更长的到期时间，债券变异性更大（敏感性越强），收到到期收益率的影响越大</h3>
<pre class="r"><code>bond_val(r=0.1,t=20,y=0.08)/bond_val(r=0.1,t=20,y=0.1)-1</code></pre>
<pre><code>## [1] 0.1963629</code></pre>
<pre class="r"><code>bond_val(r=0.1,t=10,y=0.08)/bond_val(r=0.1,t=10,y=0.1)-1</code></pre>
<pre><code>## [1] 0.1342016</code></pre>
<pre class="r"><code>#依葫芦画瓢3
short &lt;- NULL
for (i in seq(0,1,by=0.05)){
  short &lt;- c(short,bond_val(r=0.05,t=10,y=i))
}
long &lt;- NULL
for (i in seq(0,1,by=0.05)){
  long &lt;- c(long,bond_val(r=0.05,t=20,y=i))
}


df &lt;- tibble(short = short,long=long, y=seq(0,1,by=0.05)) %&gt;%
  gather(key = &#39;key&#39;,value=&#39;value&#39;,-y)

ggplot(df,aes(x=y,y=value,color=key),size=1.2,alpha=0.7) +
  geom_line(size=1.2,alpha=0.7)+ggtitle(&#39;长到期时间VS短到期时间&#39;)+
  xlab(&quot;债券的到期收益率&quot;) + ylab(&#39;债券价格&#39;)+theme_clean()</code></pre>
<p><img src="/post/bond-valuation_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
</div>
<div id="债券的久其" class="section level2">
<h2>债券的久其</h2>
<p>公式和定义ppt上已经写好了，我们直接来写function</p>
<pre class="r"><code>mac_dur &lt;- function(p=100,r,t,y) {
  cf &lt;- c(rep(p*r,t-1),p*(1+r))
  
  cf_df &lt;- as_tibble(cf)
  
  cf_df &lt;- cf_df %&gt;%
  mutate(year = as.numeric(rownames(cf_df))) %&gt;%
  rename(cf = value)
  
  cf_df &lt;- cf_df %&gt;%
  mutate(pv = cf/(1+y)^year) %&gt;%
    mutate(total_pv = year*cf/(1+y)^year)
  
  return(sum(cf_df$total_pv)/sum(cf_df$pv))
}

dur_1 &lt;-mac_dur(r=0.1,t=20,y=0.08)
dur_2 &lt;- mac_dur(r=0.3,t=10,y=0.06)

paste(&quot;小票息债券的久其是:&quot;,dur_1)</code></pre>
<pre><code>## [1] &quot;小票息债券的久其是: 10.1823263432589&quot;</code></pre>
<pre class="r"><code>paste(&quot;大票息债券的久其是:&quot;,dur_2)</code></pre>
<pre><code>## [1] &quot;大票息债券的久其是: 6.02680175748431&quot;</code></pre>
<pre class="r"><code>if (dur_2&lt;dur_1){
  print(&#39;dur_2债券的易变性（敏感性）更弱&#39;)
}else(print(&#39;dur_2债券的易变性更强&#39;))</code></pre>
<pre><code>## [1] &quot;dur_2债券的易变性（敏感性）更弱&quot;</code></pre>
<p>继续构建修正久其，修正久其就是在麦考利久其的基础上除以(1+y)</p>
<pre class="r"><code>re_dur &lt;- function(p=100,r,t,y) {
  cf &lt;- c(rep(p*r,t-1),p*(1+r))
  
  cf_df &lt;- as_tibble(cf)
  
  cf_df &lt;- cf_df %&gt;%
  mutate(year = as.numeric(rownames(cf_df))) %&gt;%
  rename(cf = value)
  
  cf_df &lt;- cf_df %&gt;%
  mutate(pv = cf/(1+y)^year) %&gt;%
    mutate(total_pv = year*cf/(1+y)^year)
  
  dur = sum(cf_df$total_pv)/sum(cf_df$pv)
  
  re_dur = dur/(1+y)
  return(re_dur)
}</code></pre>
</div>

</main>

  <footer>
  <script src="//yihui.name/js/math-code.js"></script>
<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<script async src="//yihui.name/js/center-img.js"></script>

  
  <hr/>
  © <a href="https://zhangjian.netlify.com/">张剑</a>  2020 &ndash; 2020 | <a href="https://gitee.com/jefeerzhang">Gitee</a>
  
  </footer>
  </body>
</html>

